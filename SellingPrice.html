<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product List</title>
    <style>
        label, input {
            display: block;
            margin-bottom: 10px;
        }
        button {
            margin-top: 10px;
        }
        #product-list {
            margin-top: 20px;
        }
        .product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .product-item span {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>Product List</h1>
    <form id="product-form">
        <label for="product-name">Product Name:</label>
        <input type="text" id="product-name" placeholder="Enter Product Name">

        <label for="selling-price">Selling Price:</label>
        <input type="number" id="selling-price" placeholder="Enter Selling Price">

        <button type="button" id="add-button">Add</button>
    </form>

    <div id="product-list"></div>

    <p>Total Price: <span id="total-price">0</span></p>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const apiurl = 'https://crudcrud.com/api/7cf51222a5dc48a6852b79f6a87097da/sp';
        const productForm = document.getElementById('product-form');
        const productList = document.getElementById('product-list');
        const addButton = document.getElementById('add-button');
        const totalPriceElement = document.getElementById('total-price');
        let products = [];

        // Function to add a product
        const addProduct = async () => {
            const productName = document.getElementById('product-name').value;
            const sellingPrice = parseInt(document.getElementById('selling-price').value);

            if (productName && sellingPrice) {
                const product = {
                    name: productName,
                    price: sellingPrice
                };

                try {
                    // Make a POST request to save the product in the API
                    const response = await axios.post(apiurl, product);
                    product.id = response.data._id;
                    products.push(product);
                    renderProductList();
                    updateTotalPrice();
                } catch (error) {
                    console.error('Error adding product:', error);
                }

                // Clear the form inputs
                productForm.reset();
            }
        };

        // Function to render the product list
        const renderProductList = () => {
            productList.innerHTML = '';

            for (const product of products) {
                const productItem = createProductItem(product);
                productList.appendChild(productItem);
            }
        };

        // Function to create a product item
        const createProductItem = (product) => {
            const productItem = document.createElement('div');
            productItem.classList.add('product-item');

            const productName = document.createElement('span');
            productName.textContent = product.name;

            const productPrice = document.createElement('span');
            productPrice.textContent = `$${product.price}`;

            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.addEventListener('click', async () => await deleteProduct(product));

            productItem.appendChild(productName);
            productItem.appendChild(productPrice);
            productItem.appendChild(deleteButton);

            return productItem;
        };

        // Function to delete a product
        const deleteProduct = async (product) => {
            try {
                // Make a DELETE request to remove the product from the API
                const response = await axios.delete(`${apiurl}/${product.id}`);
                if (response.status === 200) {
                    products = products.filter(p => p.id !== product.id);
                    renderProductList();
                    updateTotalPrice();
                } else {
                    console.error('Error deleting product:', response.statusText);
                }
            } catch (error) {
                console.error('Error deleting product:', error);
            }
        };

        // Function to update the total price
        const updateTotalPrice = () => {
            const totalPrice = products.reduce((sum, product) => sum + product.price, 0);
            totalPriceElement.textContent = totalPrice;
        };

        addButton.addEventListener('click', addProduct);
    </script>
</body>
</html>
